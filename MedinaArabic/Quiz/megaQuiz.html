<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible"
    content="IE=edge">
    <meta name="viewport"
    content="width=device-width, initial-scale=1.0">
    <title>Quiz</title>
    <link rel="stylesheet"
    href="style.css">
    <link rel="icon"
    href="./favicon.png">
</head>

<body>
    <h4 id="queText"></h4>
    <div class="flexgrid" id="choices">
    </div>
</body>
<script>
    const urlBook1 = "../book1edit.json"
    queText = document.getElementById("queText")
    optionsContainer = document.getElementById("choices")
    let min, max, questionText
    let NoOfAnsOptionsToShow = 6
    let outputIDs = []

    // get lesson vocab from json file
    let getVocab = () => {
        fetch(urlBook1)
            .then((response) => response.json()) // return json object
            .then((data) => {
                book1 = data
            })
            .catch((error) => {
                console.error("Error:", error)
            })
    }

    let startMegaQuiz = () => {
        min = 0
        max = book1.length
        newQuestion()
    }

    let newQuestion = () => {
        // Get new vocab ID
        getRndIDs(min, max)
        // Select first ID as answer result
        resultID = outputIDs[0]
        // Update question text 
        questionText = book1[outputIDs[0]].En
        queText.innerHTML = questionText
        // Randomise ID order for output
        outputIDs = shuffleArr(outputIDs)
        // display output options
        outputIDs.forEach(createOptions)
    }

    let getRndIDs = (min, max) => {
        outputIDs = [] // Clear array
        while (outputIDs.length < NoOfAnsOptionsToShow) {
            var r = Math.floor(Math.random() * (max - min)) + min
            if (outputIDs.indexOf(r) === -1) outputIDs.push(r)
        }
    }

    let createOptions = (value) => {
        var ansOption = document.createElement("p")
        ansOption.innerHTML = book1[value].Ar
        ansOption.classList.add("optionchoice")
        if (resultID === value) {
            ansOption.id = "ans"
            ansOption.onclick = function () { // alert("corect")
                //.. remove answers for next selection (reset state)
                while (optionsContainer.hasChildNodes()) {
                    optionsContainer.removeChild(optionsContainer.firstChild)
                }
                newQuestion()
            }
        } else { // if wrong answer selected
            ansOption.onclick = function () {
                ansOption.style.backgroundColor = "darkred"
            }
        }
        optionsContainer.appendChild(ansOption)
    }

    const shuffleArr = (array) =>
        array
            .map((a) => ({ sort: Math.random(), value: a }))
            .sort((a, b) => a.sort - b.sort)
            .map((a) => a.value)

        // self executing function here / same as jquery document ready
        ; (function () {
            getVocab()
            setTimeout(startMegaQuiz, 1000)
        })()

</script>

</html>